# TEMPO 数据导出的后端接口使用说明

导出数据的后端逻辑分三个部分

1. 发起导出和计算的“任务”，获取任务 ID。

2. 根据任务 ID 查询任务进展情况。

3. 任务执行完毕，返回 excel 文件。

## 发起任务

发起任务的后端接口如下。
其中 `line` 对应热轧产线`HSM1`和`HSM2`。
`start` 对应热轧生产的开始时间，使用一串数表示，包括年月日时分秒共 14 位。
`end` 对应热轧生产的结束时间，使用一串数表示，包括年月日时分秒共 14 位。

```
192.168.88.158:8000/tempo/export/task?line=HSM1&start=20200828000000&end=20200831000000
```

该请求返回任务的 ID 号。如下报文中的`data`所示。

```js
{
    "code": 200,
    "data": "58c9ce8d-9ea4-4b7e-9f8f-d273a9aeb694",
    "msg": "获取任务ID并开始排队计算"
}
```

## 查询任务进度

使用获得的任务 ID 查询任务进度。

```
192.168.88.158:8000/tempo/export/task/58c9ce8d-9ea4-4b7e-9f8f-d273a9aeb694
```

任务进度情况

```js
{
    "code": 200,
    "data": {
        "state": "SUCCESS",
        "info": "任务执行成功",
        "fileUrl": "/media/tempo_data_HSM1_20200828000000_20200831000000.xlsx",
        "fileUrlWithHost": "192.168.88.158:8000/media/tempo_data_HSM1_20200828000000_20200831000000.xlsx"
        },
    "msg": "查询任务结果"
}
```

## 获取 excel 文件

若任务执行成功，则获得 excel 文件的网络地址`fileUrlWithHost`，通过网络地址下载 excel 文件。

前端根据用户需求调整下载文件的方式。
